<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie10 lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie10 lt-ie9"> <![endif]-->
<!--[if IE 9]>         <html class="no-js lt-ie10"> <![endif]-->
<!--[if gt IE 9]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

@@include('../partials/_pl-head.html')

<body class="has-dynamic-header tour-focused">

    <div class="tour-mask"></div>

    <div id="tour-step-1" class="tour-message">
        <strong class="tour-tagline">Howdy</strong>
        <h2 class="tour-heading">And welcome to your new Ushahidi deployment.</h2>
        <p>While we polish up your deployment, let's take a few seconds to find a few of its most useful new tools.</p>
        <div class="tour-actions">
            <a data-cue="tour-step-5" class="cta">Skip</a>
            <button data-cue="tour-step-2" class="button">Continue</button>
        </div>
    </div>

    <div id="tour-step-2" class="tour-message">
        <h2 class="tour-heading">Collect meaningful data</h2>
        <p>You can add a post from any page in your deployment
Choose from multiple custom post types
A post can have steps and permissions for who sees it
</p>
        <div class="tour-actions">
            <a data-cue="tour-step-5" class="cta">Skip</a>
            <button data-cue="tour-step-3" class="button">Continue</button>
        </div>
    </div>

    <div id="tour-step-3" class="tour-message">
        <h2 class="tour-heading">View posts</h2>
        <p>As a map
As a list
As a visualization
</p>
        <div class="tour-actions">
            <a data-cue="tour-step-5" class="cta">Skip</a>
            <button data-cue="tour-step-4" class="button">Continue</button>
        </div>
    </div>

    <div class="tour-pin"><span class="pulse"></span></div>

    <header class="header header-compact overlay" role="banner">
        <div class="container">
            <div class="hero-image">
                <img src="http://github.ushahidi.org/dotcom-pattern-library/assets/img/map-bg.png" alt="" />
            </div>

            <div class="color-overlay">
                <div class="parallax">
                    <div class="nav-icon nav-icon-js">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    <h1 class="beta">March on City Hall</h1>
                    <p class="header-description">Reports and communication about the protest march Wednesday, Aug. 19 to City Hall.</p>
                    <a data-message="tour-step-2" class="button button-create icon-only" href="choose-post-type.html">
                        <span>Add Post</span>
                    </a>

                    @@include('../partials/_user-admin.html')

                </div>
            </div>

        </div>
    </header>

    <div class="wrapper">

        @@include('../partials/_main-menu-loggedout.html')

        <main class="page-content has-aside" role="main">

            <h1>All Posts</h1>

            <div class="tabs-with-filter">
                <nav class="tabs-menu" data-message="tour-step-3">
                    <label class="delta-alt">View </label>
                    <button type="button" class="button-toggle tabs-menu-button-js"></button>
                    <ul class="tabs-menu-list">
                        <li class="active view-map"><a>Map</a></li>
                        <li class="view-list"><a>List</a></li>
                        <li class="view-chart"><a>Bar Chart</a></li>
                        <li class="view-timeline"><a>Timeline</a></li>
                    </ul>
                </nav>
            </div><!--end view with filter-->

            @@include('../partials/_filters-aside.html')

            <div class="main-col">

                <div id="map" class="map"></div>

            </div> <!--end main column-->

        </main> <!--end layout a-->

    </div>

    <footer role="contentinfo">
        <div class="wrapper">
            <div class="footer-container">
                <div class="footer-main-col">
                    <h2>March on City Hall</h2>
                    <p>Reports and communication about the protest march Wednesday, Aug. 19 to City Hall.</p>
                    <ul class="footer-nav">
                        <li><a href="">Home</a></li>
                        <li><a href="">About</a></li>
                        <li><a href="">Activity</a></li>
                        <li><a href="">Settings</a></li>
                        <li><a href="">Help</a></li>
                    </ul>
                </div>
                <div class="footer-secondary-col">
                    <a class="button button-create">
                        <span>Add Post</span>
                    </a>
                </div>
            </div>
        </div>
    </footer>


@@include('../partials/_scripts.html')

<script>
// Make header dynamic
headerMakeDynamic();

tourPin = function(element, position) {
    var targetPos = $(element).offset(),
        message = $(element).attr('data-message'),
        targetWidth = $(element).outerWidth(),
        targetHeight = $(element).outerHeight();

    if (typeof position === 'undefined') {
        $('.tour-pin').css({
            'top' : '-100%',
            'left' : '50%'
        });
    } else if (position === 'top-left') {
        $('.tour-pin').css({
            'top' : targetPos.top - 10,
            'left' : targetPos.left - 10
        });
    } else if (position === 'top-right') {
        $('.tour-pin').css({
            'top' : targetPos.top,
            'left' : targetPos.left + targetWidth - 10
        });
    } else if (position === 'bottom-left') {
        $('.tour-pin').css({
            'top' : targetPos.top + targetHeight - 10,
            'left' : targetPos.left
        });
    } else if (position === 'bottom-right') {
        $('.tour-pin').css({
            'top' : targetPos.top + targetHeight - 10,
            'left' : targetPos.left + targetWidth - 10
        });
    } else if (position === 'center') {
        $('.tour-pin').css({
            'top' : targetPos.top + targetHeight/2 - 10,
            'left' : targetPos.left + targetWidth/2 - 10
        });
    } else if (position === 'top-center') {
        $('.tour-pin').css({
            'top' : targetPos.top,
            'left' : targetPos.left + targetWidth/2 - 10
        });
    } else if (position === 'bottom-center') {
        $('.tour-pin').css({
            'top' : targetPos.top + targetHeight - 10,
            'left' : targetPos.left + targetWidth/2 - 10

        });
    }

    if (typeof element !== 'undefined') {
        // Position message
        $('#'+message).css({
            'top' : targetPos.top + targetHeight + 40
        });

        if ($(window).width() >= 1024) {
            $('#'+message).css({
                'left' : targetPos.left + targetWidth/2 - 3
            });
        }

        if (targetPos.top > ($(window).height()/2)) {
            $('html, body').animate({
                scrollTop: targetPos.top - 40
            }, 1000);
        }
    }
}

tourStep = function(step) {
    // Change body class to indicate new step
    $('body').removeClass(function (index, css) {
        return (css.match (/(^|\s)tour-step-\S+/g) || []).join(' ');
    }).addClass(step);

    if (step == 'tour-step-1') {
        $('.tour-mask').fadeIn(500);
        tourPin(); // Position pin and message
    } else {
        $('.tour-mask').fadeOut(500); // Fade out mask
        tourPin('[data-message="'+step+'"]', 'bottom-center'); // Position pin and message
    }
}

$(document).ready(function(){
    function lookupStep() {
        if (window.location.hash) {
            return window.location.hash.substr(1);
        } else {
            return 'tour-step-1';
        }
    }

    var step = lookupStep();

    // Disable all other links and buttons on the deployment
    $('*').not('[data-cue]').on('click', function(e){
        e.preventDefault();
    }).off('click');

    // Click event for cue buttons
    $('[data-cue]').on('click', function() {
        var nextStep = $(this).attr('data-cue');

        tourStep(nextStep);

        if (history.pushState) {
            history.pushState(null, null, '#'+nextStep);
        } else {
            window.location.hash = nextStep;
        }
    });

    // Animate in the appropriate step
    setTimeout(function(){
        console.log('Step: '+step+'');
        tourStep(step);
    }, 1000);

    window.onpopstate = function(event) {
        tourStep(lookupStep());
        console.log('pop: '+lookupStep()+'')
    };
});

</script>
</body>

</html>
